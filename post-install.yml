- hosts: localhost
  become: yes
  become_user: root
  tasks:
    - name: Install Flatpak development tools
      dnf:
        state: present
        name:
          - flatpak
          - flatpak-builder

    # Add Flatpak remotes
    - name: Add Flathub remote
      flatpak_remote:
        state: present
        name: flathub
        flatpakrepo_url: https://flathub.org/repo/flathub.flatpakrepo

    - name: Add Flathub beta remote
      flatpak_remote:
        state: present
        name: flathub-beta
        flatpakrepo_url: https://flathub.org/beta-repo/flathub-beta.flatpakrepo

    - name: Add GNOME Nightly remote
      flatpak_remote:
        state: present
        name: gnome-nightly
        flatpakrepo_url: https://nightly.gnome.org/gnome-nightly.flatpakrepo 

    - name: Add KDE Flatpak remote
      flatpak_remote:
        state: present
        name: kdeapps
        flatpakrepo_url: https://distribute.kde.org/kdeapps.flatpakrepo

    # Enable several copr repositories.
    - name: Enable opentabletdriver from copr
      community.general.copr:
        state: enabled
        name: cappyishihara/opentabletdriver

    - name: Enable lazygit from copr
      community.general.copr:
        state: enabled
        name: atim/lazygit

    - name: Enable gopass from copr
      community.general.copr:
        state: enabled
        name: fale/gopass

    - name: Enable Iosevka from copr
      community.general.copr:
        state: enabled
        name: peterwu/iosevka

    # Package installations.
    - name: Install packages from enabled copr repositories
      dnf:
        state: present
        name:
          - lazygit
          - opentabletdriver
          - golang-github-gopasspw-gopass
          - iosevka-fonts
          - iosevka-curly-fonts
          - iosevka-curly-slab-fonts
          - iosevka-slab-fonts
          - iosevka-etoile-fonts

    - name: Set minimal development environment
      dnf:
        state: present
        name:
          - neovim
          - python-neovim
          - git
          - kitty
          - kitty-doc
          - kitty-terminfo
          - man-db
          - man-pages

    - name: Install additional development tools
      dnf:
        state: present
        name:
          - tealdeer
          - bat
          - fzf
          - exa
          - ripgrep
          - sqlite
          - zoxide
          - direnv

    - name: Install RPM development tools
      dnf:
        state: present
        name:
          - rpm-build
          - go-rpm-macros

    - name: Setup container development tools
      dnf:
        state: present
        name:
          - podman
          - toolbox
          - openssl

    - name: Install backup tools
      dnf:
        state: present
        name:
          - borgbackup
          - borgmatic

    - name: Install (Doom) Emacs with its required dependencies
      dnf:
        state: present
        name:
          - emacs
          - libvterm
          - aspell
          - aspell-en
          - wordnet
          - zstd

    - name: Install web-related tools
      dnf:
        state: present
        name:
          - thunderbird
          - chromium
          - firefox

    - name: Install extra dependencies
      dnf:
        state: present
        name:
          - editorconfig
          - ImageMagick
          - ImageMagick-doc
          - ImageMagick-libs
          - hyperfine
          - libtree-sitter
          - recoll
          - recoll-gssp
          - recoll-kio
          - starship

    - name: Install Fedora COPR dev't tools
      dnf:
        state: present
        name:
          - copr-cli
          - dnf-plugins-core

    - name: Install i18n tools
      dnf:
        state: present
        name:
          - fcitx5
          - fcitx5-configtool
          - fcitx5-gtk4
          - fcitx5-lua
          - fcitx5-mozc
          - fcitx5-rime
          - librime
          - librime-tools
          - mozc

    - name: Install Ansible
      dnf:
        state: present
        name:
          - ansible
          - ansible-doc
          - ansible-collection-community-general
          - python3-psutil

    - name: Install fonts
      dnf:
        state: present
        name:
          - adobe-source-code-pro-fonts
          - adobe-source-sans-pro-fonts
          - adobe-source-serif-pro-fonts
          - google-noto-cjk-fonts
          - google-noto-cjk-fonts-common
          - google-noto-emoji-fonts
          - google-noto-sans-fonts
          - google-noto-serif-fonts

    # Install applications from Flatpak
    - name: Install Zrythm, a DAW
      flatpak:
        state: present
        name: org.zrythm.Zrythm
        remote: flathub

    - name: Install Krita
      flatpak:
        state: present
        name: org.kde.krita
        remote: flathub

    - name: Install Krita nightly
      flatpak:
        state: present
        name: org.kde.krita-nightly
        remote: kdeapps

    - name: Install Junction, an application launcher
      flatpak:
        state: present
        name: re.sonny.Junction
        remote: flathub

    - name: Install Tangram, a browser
      flatpak:
        state: present
        name: re.sonny.Tangram
        remote: flathub

    - name: Install Blender, a 3D modelling software
      flatpak:
        state: present
        name: org.blender.Blender
        remote: flathub

    - name: Install Lutris
      flatpak:
        state: present
        name: net.lutris.Lutris
        remote: flathub-beta

    - name: Install Steam
      flatpak:
        state: present
        name: com.valvesoftware.Steam
        remote: flathub

    - name: Install Emulsion, a color palette manager
      flatpak:
        state: present
        name: io.github.lainsce.Emulsion
        remote: flathub

    - name: Install Inkscape, an alternative to Adobe Illustrator
      flatpak:
        state: present
        name: org.inkscape.Inkscape
        remote: flathub

    - name: Install OBS Studio, the Swiss army knife for screencasts
      flatpak:
        state: present
        name: com.obsproject.Studio
        remote: flathub

    - name: Install Flatseal, a Flatpak app permissions manager
      flatpak:
        state: present
        name: com.github.tchx84.Flatseal
        remote: flathub

    - name: Install Helvum, a Patchbay-like app
      flatpak:
        state: present
        name: org.pipewire.Helvum
        remote: flathub

    - name: Install EasyEffects, an audio effects app
      flatpak:
        state: present
        name: com.github.wwmm.easyeffects
        remote: flathub

    - name: Install 0 A.D., a RTS game
      flatpak:
        state: present
        name: com.play0ad.zeroad
        remote: flathub

    - name: Install Remnants of the Precursors, a 4X game
      flatpak:
        state: present
        name: com.remnantsoftheprecursors.ROTP
        remote: flathub

    - name: Install Musescore, a music composition software
      flatpak:
        state: present
        name: org.musescore.MuseScore
        remote: flathub

    - name: Install Bottles, a Windows app runner
      flatpak:
        state: present
        name: com.usebottles.bottles
        remote: flathub

    - name: Install GIMP (nightly), a photo editor
      flatpak:
        state: present
        name: org.gimp.GIMP
        remote: gnome-nightly

    # Configure desktop environment.
    - name: Install dconf keyfiles
      copy:
        src: ./files/dconf/
        dest: /etc/dconf/db/a-happy-gnome.d

    - name: Set 'user' dconf profile with the custom GNOME config
      ansible.builtin.shell: echo "system-db:a-happy-gnome" >> /etc/dconf/profile/user

    - name: Enable night light in GNOME
      dconf:
        state: present
        key: /org/gnome/settings-daemon/plugins/color/night-light-enabled
        value: true

    # TODO:
    # * Configure GNOME with dconf module
    # * Configure GNOME extensions
